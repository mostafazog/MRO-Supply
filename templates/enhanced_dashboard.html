<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MRO Supply Scraper - Control Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    <style>
        body {
            background-color: #f8f9fa;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        .navbar {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .metric-card {
            border: none;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
            transition: transform 0.2s;
        }
        .metric-card:hover {
            transform: translateY(-3px);
        }
        .control-btn {
            padding: 10px 24px;
            border-radius: 8px;
            font-weight: 600;
            border: none;
            transition: all 0.2s;
        }
        .control-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        .log-viewer {
            background: #1e1e1e;
            color: #d4d4d4;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            padding: 15px;
            border-radius: 8px;
            height: 400px;
            overflow-y: auto;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        .log-line {
            margin: 2px 0;
        }
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
            animation: pulse 2s infinite;
        }
        .status-running {
            background: #28a745;
        }
        .status-stopped {
            background: #dc3545;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        .file-item {
            padding: 12px;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            margin-bottom: 10px;
            transition: all 0.2s;
        }
        .file-item:hover {
            background: #f8f9fa;
            border-color: #667eea;
        }
        .tab-content {
            padding: 20px 0;
        }
        .config-input {
            font-family: monospace;
        }
    </style>
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar navbar-dark">
        <div class="container-fluid">
            <span class="navbar-brand mb-0 h1">
                <i class="bi bi-speedometer2"></i>
                MRO Supply Scraper - Control Dashboard
            </span>
            <div class="d-flex align-items-center">
                <span class="text-white me-3" id="scraper-status">
                    <span class="status-indicator status-stopped"></span>
                    Checking...
                </span>
                <a href="/logout" class="btn btn-light btn-sm">
                    <i class="bi bi-box-arrow-right"></i> Logout
                </a>
            </div>
        </div>
    </nav>

    <div class="container-fluid mt-4">
        <!-- Control Tabs -->
        <ul class="nav nav-tabs mb-3" id="controlTabs" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="control-tab" data-bs-toggle="tab" data-bs-target="#control" type="button">
                    <i class="bi bi-play-circle"></i> Control
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="logs-tab" data-bs-toggle="tab" data-bs-target="#logs" type="button">
                    <i class="bi bi-file-text"></i> Logs
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="files-tab" data-bs-toggle="tab" data-bs-target="#files" type="button">
                    <i class="bi bi-download"></i> Download Files
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="config-tab" data-bs-toggle="tab" data-bs-target="#config" type="button">
                    <i class="bi bi-gear"></i> Configuration
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="monitor-tab" data-bs-toggle="tab" data-bs-target="#monitor" type="button">
                    <i class="bi bi-graph-up"></i> Monitor
                </button>
            </li>
        </ul>

        <div class="tab-content" id="controlTabContent">
            <!-- Control Tab -->
            <div class="tab-pane fade show active" id="control" role="tabpanel">
                <div class="row">
                    <div class="col-md-6">
                        <div class="card metric-card">
                            <div class="card-body">
                                <h5 class="card-title"><i class="bi bi-play-circle"></i> Start Scraper</h5>
                                <p class="text-muted">Configure and start the scraping process</p>

                                <div class="mb-3">
                                    <label class="form-label">Script</label>
                                    <select class="form-select" id="start-script">
                                        <option value="url_file_scraper_webshare.py --url-file all_product_urls_20251215_230531.txt">URL File Scraper (1.5M URLs + Webshare) ⭐ RECOMMENDED</option>
                                        <option value="production_scraper_webshare.py">Production (Search Pages + Webshare)</option>
                                        <option value="fast_scraper_webshare.py">Fast Scraper (Webshare)</option>
                                        <option value="fast_scraper.py">Fast Scraper (No Proxies)</option>
                                    </select>
                                </div>

                                <div class="mb-3">
                                    <label class="form-label">Max Products (optional)</label>
                                    <input type="number" class="form-control" id="start-max-products" placeholder="Leave empty for all products">
                                </div>

                                <div class="mb-3">
                                    <label class="form-label">Workers</label>
                                    <input type="number" class="form-control" id="start-workers" value="10">
                                </div>

                                <button class="btn btn-success control-btn w-100" id="btn-start" onclick="startScraper()">
                                    <i class="bi bi-play-fill"></i> Start Scraper
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-6">
                        <div class="card metric-card">
                            <div class="card-body">
                                <h5 class="card-title"><i class="bi bi-stop-circle"></i> Stop Scraper</h5>
                                <p class="text-muted">Gracefully stop the running scraper</p>

                                <div class="alert alert-warning">
                                    <i class="bi bi-exclamation-triangle"></i>
                                    This will attempt a graceful shutdown first, then force stop if needed.
                                    Progress will be saved to checkpoint file.
                                </div>

                                <div id="process-info" class="mb-3" style="display: none;">
                                    <strong>Process Info:</strong><br>
                                    <small>
                                        PID: <span id="process-pid">-</span><br>
                                        Uptime: <span id="process-uptime">-</span><br>
                                        Command: <code id="process-cmd">-</code>
                                    </small>
                                </div>

                                <button class="btn btn-danger control-btn w-100" id="btn-stop" onclick="stopScraper()">
                                    <i class="bi bi-stop-fill"></i> Stop Scraper
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Status Card -->
                <div class="row mt-4">
                    <div class="col-12">
                        <div class="card metric-card">
                            <div class="card-body">
                                <h5 class="card-title"><i class="bi bi-activity"></i> Progress</h5>
                                <div id="progress-section">
                                    <p class="text-muted">Waiting for data...</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Logs Tab -->
            <div class="tab-pane fade" id="logs" role="tabpanel">
                <div class="card metric-card">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <h5 class="card-title mb-0"><i class="bi bi-terminal"></i> Real-time Logs</h5>
                            <div>
                                <button class="btn btn-sm btn-primary" onclick="refreshLogs()">
                                    <i class="bi bi-arrow-clockwise"></i> Refresh
                                </button>
                                <button class="btn btn-sm btn-secondary" onclick="toggleAutoRefresh()">
                                    <i class="bi bi-stopwatch"></i> <span id="auto-refresh-text">Auto: OFF</span>
                                </button>
                                <button class="btn btn-sm btn-danger" onclick="clearLogs()">
                                    <i class="bi bi-trash"></i> Clear Logs
                                </button>
                            </div>
                        </div>
                        <div class="log-viewer" id="log-viewer">
                            Loading logs...
                        </div>
                    </div>
                </div>
            </div>

            <!-- Files Tab -->
            <div class="tab-pane fade" id="files" role="tabpanel">
                <div class="card metric-card">
                    <div class="card-body">
                        <h5 class="card-title"><i class="bi bi-files"></i> Downloadable Files</h5>
                        <p class="text-muted">Download scraped data and reports</p>

                        <div id="files-list">
                            <p class="text-center">Loading files...</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Configuration Tab -->
            <div class="tab-pane fade" id="config" role="tabpanel">
                <div class="row">
                    <div class="col-md-6">
                        <div class="card metric-card">
                            <div class="card-body">
                                <h5 class="card-title"><i class="bi bi-key"></i> Webshare API Key</h5>
                                <p class="text-muted">Update your Webshare proxy API key</p>

                                <div class="mb-3">
                                    <label class="form-label">Current API Key</label>
                                    <input type="text" class="form-control config-input" id="current-api-key" readonly value="Loading...">
                                </div>

                                <div class="mb-3">
                                    <label class="form-label">New API Key</label>
                                    <input type="password" class="form-control config-input" id="new-api-key" placeholder="Enter new API key">
                                    <small class="text-muted">Restart scraper after updating</small>
                                </div>

                                <button class="btn btn-primary w-100" onclick="updateWebshareKey()">
                                    <i class="bi bi-check-circle"></i> Update API Key
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="col-md-6">
                        <div class="card metric-card">
                            <div class="card-body">
                                <h5 class="card-title"><i class="bi bi-info-circle"></i> Configuration Info</h5>
                                <p class="text-muted">Current system configuration</p>

                                <div class="alert alert-info">
                                    <strong>Note:</strong> Configuration changes require a scraper restart to take effect.
                                </div>

                                <p><strong>Configuration File:</strong> <code>.env</code></p>
                                <p><strong>Output Directory:</strong> <code>test_output/</code></p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Monitor Tab -->
            <div class="tab-pane fade" id="monitor" role="tabpanel">
                <div class="row">
                    <div class="col-md-3">
                        <div class="card metric-card text-center">
                            <div class="card-body">
                                <i class="bi bi-cpu metric-icon text-primary"></i>
                                <div class="metric-value" id="cpu-usage">-</div>
                                <div class="metric-label">CPU Usage</div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card metric-card text-center">
                            <div class="card-body">
                                <i class="bi bi-memory metric-icon text-success"></i>
                                <div class="metric-value" id="memory-usage">-</div>
                                <div class="metric-label">Memory Usage</div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card metric-card text-center">
                            <div class="card-body">
                                <i class="bi bi-hdd metric-icon text-info"></i>
                                <div class="metric-value" id="disk-usage">-</div>
                                <div class="metric-label">Disk Usage</div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card metric-card text-center">
                            <div class="card-body">
                                <i class="bi bi-check-circle metric-icon text-success"></i>
                                <div class="metric-value" id="products-count">-</div>
                                <div class="metric-label">Products Scraped</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Distributed Systems Section -->
                <div class="row mt-4">
                    <div class="col-md-6">
                        <div class="card metric-card">
                            <div class="card-body">
                                <h5 class="card-title">
                                    <i class="bi bi-github"></i> GitHub Actions
                                    <button class="btn btn-sm btn-success float-end" onclick="triggerGitHubActions()">
                                        <i class="bi bi-play-fill"></i> Trigger Workflow
                                    </button>
                                </h5>
                                <div id="github-status">
                                    <p class="text-muted">Loading...</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card metric-card">
                            <div class="card-body">
                                <h5 class="card-title">
                                    <i class="bi bi-cloud"></i> Azure Functions
                                </h5>
                                <div id="azure-status">
                                    <p class="text-muted">Loading...</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Notifications -->
    <div class="position-fixed bottom-0 end-0 p-3" style="z-index: 9999">
        <div id="toast" class="toast" role="alert">
            <div class="toast-header">
                <strong class="me-auto" id="toast-title">Notification</strong>
                <button type="button" class="btn-close" data-bs-dismiss="toast"></button>
            </div>
            <div class="toast-body" id="toast-body">
                Message
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        let autoRefreshInterval = null;
        let autoRefreshEnabled = false;

        // Show toast notification
        function showToast(title, message, type = 'info') {
            const toast = document.getElementById('toast');
            const toastTitle = document.getElementById('toast-title');
            const toastBody = document.getElementById('toast-body');

            toastTitle.textContent = title;
            toastBody.textContent = message;

            const bsToast = new bootstrap.Toast(toast);
            bsToast.show();
        }

        // Start scraper
        async function startScraper() {
            const script = document.getElementById('start-script').value;
            const maxProducts = document.getElementById('start-max-products').value;
            const workers = document.getElementById('start-workers').value;

            const data = {
                script: script,
                workers: parseInt(workers)
            };

            if (maxProducts) {
                data.max_products = parseInt(maxProducts);
            }

            try {
                const response = await fetch('/api/scraper/start', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(data)
                });

                const result = await response.json();

                if (result.success) {
                    showToast('Success', result.message, 'success');
                    updateScraperStatus();
                } else {
                    showToast('Error', result.message, 'error');
                }
            } catch (error) {
                showToast('Error', 'Failed to start scraper: ' + error.message, 'error');
            }
        }

        // Stop scraper
        async function stopScraper() {
            if (!confirm('Are you sure you want to stop the scraper?')) {
                return;
            }

            try {
                const response = await fetch('/api/scraper/stop', {
                    method: 'POST'
                });

                const result = await response.json();

                if (result.success) {
                    showToast('Success', result.message, 'success');
                    updateScraperStatus();
                } else {
                    showToast('Error', result.message, 'error');
                }
            } catch (error) {
                showToast('Error', 'Failed to stop scraper: ' + error.message, 'error');
            }
        }

        // Update scraper status
        async function updateScraperStatus() {
            try {
                const response = await fetch('/api/scraper/status');
                const status = await response.json();

                const indicator = document.querySelector('.status-indicator');
                const statusText = document.getElementById('scraper-status');
                const processInfo = document.getElementById('process-info');

                if (status.running) {
                    indicator.className = 'status-indicator status-running';
                    statusText.innerHTML = '<span class="status-indicator status-running"></span>Running';

                    if (status.pid) {
                        document.getElementById('process-pid').textContent = status.pid;
                        document.getElementById('process-uptime').textContent = status.uptime || 'Unknown';
                        document.getElementById('process-cmd').textContent = status.command || 'Unknown';
                        processInfo.style.display = 'block';
                    }
                } else {
                    indicator.className = 'status-indicator status-stopped';
                    statusText.innerHTML = '<span class="status-indicator status-stopped"></span>Stopped';
                    processInfo.style.display = 'none';
                }

                // Update progress
                updateProgress();
            } catch (error) {
                console.error('Error updating status:', error);
            }
        }

        // Update progress
        async function updateProgress() {
            try {
                const response = await fetch('/api/status');
                const status = await response.json();

                const section = document.getElementById('progress-section');

                if (status.completed > 0) {
                    section.innerHTML = `
                        <div class="mb-2">
                            <strong>Progress:</strong> ${status.completed.toLocaleString()} / ${status.total.toLocaleString()} (${status.percent}%)
                        </div>
                        <div class="progress" style="height: 25px;">
                            <div class="progress-bar bg-success" style="width: ${status.percent}%">${status.percent}%</div>
                        </div>
                        <small class="text-muted mt-2 d-block">Last updated: ${new Date(status.last_update).toLocaleString()}</small>
                    `;
                } else {
                    section.innerHTML = '<p class="text-muted">No progress data available</p>';
                }
            } catch (error) {
                console.error('Error updating progress:', error);
            }
        }

        // Refresh logs
        async function refreshLogs() {
            try {
                const response = await fetch('/api/logs/tail?lines=100');
                const data = await response.json();

                const viewer = document.getElementById('log-viewer');
                viewer.textContent = data.lines || 'No log data available';
                viewer.scrollTop = viewer.scrollHeight;
            } catch (error) {
                console.error('Error refreshing logs:', error);
            }
        }

        // Toggle auto-refresh
        function toggleAutoRefresh() {
            autoRefreshEnabled = !autoRefreshEnabled;
            const text = document.getElementById('auto-refresh-text');

            if (autoRefreshEnabled) {
                text.textContent = 'Auto: ON';
                autoRefreshInterval = setInterval(refreshLogs, 5000);
                refreshLogs();
            } else {
                text.textContent = 'Auto: OFF';
                if (autoRefreshInterval) {
                    clearInterval(autoRefreshInterval);
                }
            }
        }

        // Clear logs
        async function clearLogs() {
            if (!confirm('Are you sure you want to clear the log file? This cannot be undone.')) {
                return;
            }

            try {
                const response = await fetch('/api/logs/clear', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'}
                });

                const result = await response.json();

                if (result.success) {
                    showToast('Success', result.message, 'success');
                    refreshLogs();
                } else {
                    showToast('Error', result.message, 'error');
                }
            } catch (error) {
                showToast('Error', 'Failed to clear logs: ' + error.message, 'error');
            }
        }

        // Load files list
        async function loadFiles() {
            try {
                const response = await fetch('/api/files/list');
                const data = await response.json();

                const filesList = document.getElementById('files-list');

                if (data.files && data.files.length > 0) {
                    filesList.innerHTML = data.files.map(file => `
                        <div class="file-item">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <i class="bi bi-file-earmark-${file.type === 'json' ? 'code' : file.type === 'csv' ? 'spreadsheet' : 'text'}"></i>
                                    <strong>${file.name}</strong>
                                    <br>
                                    <small class="text-muted">${file.size_mb} MB • ${new Date(file.modified).toLocaleString()}</small>
                                </div>
                                <a href="/api/files/download/${file.name}" class="btn btn-primary btn-sm">
                                    <i class="bi bi-download"></i> Download
                                </a>
                            </div>
                        </div>
                    `).join('');
                } else {
                    filesList.innerHTML = '<p class="text-center text-muted">No files available</p>';
                }
            } catch (error) {
                console.error('Error loading files:', error);
            }
        }

        // Load Webshare config
        async function loadWebshareConfig() {
            try {
                const response = await fetch('/api/config/webshare');
                const data = await response.json();

                document.getElementById('current-api-key').value = data.api_key || 'Not configured';
            } catch (error) {
                console.error('Error loading config:', error);
            }
        }

        // Update Webshare key
        async function updateWebshareKey() {
            const newKey = document.getElementById('new-api-key').value.trim();

            if (!newKey) {
                showToast('Error', 'Please enter an API key', 'error');
                return;
            }

            try {
                const response = await fetch('/api/config/webshare', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({api_key: newKey})
                });

                const result = await response.json();

                if (result.success) {
                    showToast('Success', result.message, 'success');
                    document.getElementById('new-api-key').value = '';
                    loadWebshareConfig();
                } else {
                    showToast('Error', result.message, 'error');
                }
            } catch (error) {
                showToast('Error', 'Failed to update API key: ' + error.message, 'error');
            }
        }

        // Update system stats
        async function updateSystemStats() {
            try {
                const response = await fetch('/api/system');
                const data = await response.json();

                document.getElementById('cpu-usage').textContent = data.cpu_percent + '%';
                document.getElementById('memory-usage').textContent = data.memory_percent + '%';
                document.getElementById('disk-usage').textContent = data.disk_percent + '%';

                // Update products count
                const statusResp = await fetch('/api/status');
                const status = await statusResp.json();
                document.getElementById('products-count').textContent = status.completed.toLocaleString();
            } catch (error) {
                console.error('Error updating stats:', error);
            }
        }

        // Update GitHub Actions status
        async function updateGitHubStatus() {
            try {
                const response = await fetch('/api/github/workflows');
                const data = await response.json();

                const container = document.getElementById('github-status');

                if (!data.configured) {
                    container.innerHTML = '<div class="alert alert-warning"><i class="bi bi-exclamation-triangle"></i> GitHub token not configured</div>';
                    return;
                }

                if (data.workflows && data.workflows.length > 0) {
                    let html = '<table class="table table-sm"><thead><tr><th>Run #</th><th>Status</th><th>Link</th></tr></thead><tbody>';
                    data.workflows.slice(0, 3).forEach(w => {
                        const statusBadge = w.status === 'completed' ?
                            `<span class="badge bg-${w.conclusion === 'success' ? 'success' : 'danger'}">${w.conclusion}</span>` :
                            `<span class="badge bg-warning">${w.status}</span>`;
                        html += `<tr><td>#${w.run_number}</td><td>${statusBadge}</td><td><a href="${w.html_url}" target="_blank"><i class="bi bi-box-arrow-up-right"></i></a></td></tr>`;
                    });
                    html += '</tbody></table>';
                    container.innerHTML = html;
                } else {
                    container.innerHTML = '<p class="text-muted">No workflow runs found</p>';
                }
            } catch (error) {
                console.error('Error updating GitHub status:', error);
                document.getElementById('github-status').innerHTML = '<p class="text-danger">Error loading status</p>';
            }
        }

        // Update Azure Functions status
        async function updateAzureStatus() {
            try {
                const response = await fetch('/api/azure/status');
                const data = await response.json();

                const container = document.getElementById('azure-status');

                if (!data.configured) {
                    container.innerHTML = '<div class="alert alert-warning"><i class="bi bi-exclamation-triangle"></i> Azure URL not configured</div>';
                    return;
                }

                const statusColor = data.status === 'healthy' ? 'success' :
                                   data.status === 'unhealthy' ? 'danger' : 'warning';

                let html = `
                    <div class="alert alert-${statusColor}">
                        <strong>Status:</strong> ${data.status.toUpperCase()}<br>
                        <strong>URL:</strong> <small>${data.url}</small>
                    </div>
                `;

                if (data.error) {
                    html += `<p class="text-muted"><small>Error: ${data.error}</small></p>`;
                }

                container.innerHTML = html;
            } catch (error) {
                console.error('Error updating Azure status:', error);
                document.getElementById('azure-status').innerHTML = '<p class="text-danger">Error loading status</p>';
            }
        }

        // Trigger GitHub Actions workflow
        async function triggerGitHubActions() {
            if (!confirm('Start GitHub Actions workflow with 50 workers + Azure Functions?')) {
                return;
            }

            try {
                const response = await fetch('/api/github/trigger', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        total_products: '1508714',
                        batch_size: '100',
                        use_azure_functions: 'true',
                        github_workers: '50'
                    })
                });

                const result = await response.json();

                if (result.success) {
                    showToast('Success', result.message, 'success');
                    setTimeout(updateGitHubStatus, 2000);
                } else {
                    showToast('Error', result.message, 'error');
                }
            } catch (error) {
                showToast('Error', 'Failed to trigger workflow: ' + error.message, 'error');
            }
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            updateScraperStatus();
            loadFiles();
            loadWebshareConfig();
            updateSystemStats();

            // Auto-refresh every 5 seconds
            setInterval(updateScraperStatus, 5000);
            setInterval(updateSystemStats, 10000);
            setInterval(updateGitHubStatus, 15000);
            setInterval(updateAzureStatus, 15000);

            // Tab change handlers
            document.getElementById('logs-tab').addEventListener('shown.bs.tab', function() {
                refreshLogs();
            });

            document.getElementById('files-tab').addEventListener('shown.bs.tab', function() {
                loadFiles();
            });

            document.getElementById('monitor-tab').addEventListener('shown.bs.tab', function() {
                updateGitHubStatus();
                updateAzureStatus();
            });
        });
    </script>
</body>
</html>
